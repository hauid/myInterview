#### **RPC**

纯裸TCP收发的这些 01 串之间是**没有任何边界**的,存在**粘包问题**

于是我们会把每条要发送的数据都包装一下，比如加入**消息头**，**消息头里写清楚一个完整的包长度是多少**，根据这个长度可以继续接收数据，截取出来后它们就是我们真正要传输的**消息体**。

**RPC**（**R**emote **P**rocedure **C**all），又叫做**远程过程调用**。它本身并不是一个具体的协议，而是一种**调用方式**。



##### 底层连接形式

以主流的**HTTP1.1**协议为例，其默认在建立底层TCP连接之后会一直保持这个连接（**keep alive**），之后的请求和响应都会复用这条连接。

而**RPC**协议，也跟HTTP类似，也是通过建立TCP长链接进行数据交互，但不同的地方在于，RPC协议一般还会再建个连接池，在请求量大的时候，建立多条连接放在池内，要发数据的时候就从池里取一条连接出来，用完放回去，下次再复用，可以说非常环保。

**由于连接池有利于提升网络请求性能，所以不少编程语言的网络库里都会给HTTP加个连接池**，比如**go**就是这么干的。

可以看出这一块两者也没太大区别，所以也不是关键。

##### 传输的内容

​	基于TCP传输的消息，说到底，无非都是**消息头header和消息体body。**header是用于标记一些特殊信息，其中最重要的是消息体长度**。**body则是放我们真正需要传输的内容

​	最明显的，像`header`里的那些信息，其实如果我们约定好头部的第几位是content-type，就**不需要每次都真的把"content-type"这个字段都传过来**，类似的情况其实在`body`的json结构里也特别明显。

​	而RPC，因为它定制化程度更高，可以采用体积更小的protobuf或其他序列化协议去保存结构体数据，同时也不需要像HTTP那样考虑各种浏览器行为，比如302重定向跳转啥的。**因此性能也会更好一些，这也是在公司内部微服务中抛弃HTTP，选择使用RPC的最主要原因。**

​	上面说的HTTP，其实**特指的是现在主流使用的HTTP1.1**，`HTTP2`在前者的基础上做了很多改进，所以**性能可能比很多RPC协议还要好**，甚至连`gRPC`底层都直接用的`HTTP2`。



##### 总结

- 纯裸TCP是能收发数据，但它是个**无边界**的数据流，上层需要定义**消息格式**用于定义**消息边界**。于是就有了各种协议，HTTP和各类RPC协议就是在TCP之上定义的应用层协议。
- **RPC本质上不算是协议，而是一种调用方式**，而像gRPC和thrift这样的具体实现，才是协议，它们是实现了RPC调用的协议。目的是希望程序员能像调用本地方法那样去调用远端的服务方法。同时RPC有很多种实现方式，**不一定非得基于TCP协议**。
- 从发展历史来说，HTTP主要用于b/s架构，而RPC更多用于c/s架构。但现在其实已经没分那么清了，b/s和c/s在慢慢融合。 很多软件同时支持多端，所以对外一般用HTTP协议，而**内部集群的微服务之间则采用RPC协议进行通讯**。
- RPC其实比HTTP出现的要早，且比目前主流的HTTP1.1性能要更好，所以大部分公司内部都还在使用RPC。
- **HTTP2.0**在**HTTP1.1**的基础上做了优化，性能可能比很多RPC协议都要好，但由于是这几年才出来的，所以也不太可能取代掉RPC。





#### 简要对比

HTTP传统1.0是**文本协议**,可读性高,但是效率低

GRPC:基于HTTP2.0 二进制协议,**可读性比较低,但传输效率高**

- 传输二进制数据
- 提前定义好了一个protobuf文件,提供和调用方都共用这一份文件.按照约定处理数据



####  WebSocket 的工作流程

- **握手阶段**：通过 HTTP 协议升级为 WebSocket 连接。
- **通信阶段**：建立全双工通道，通过帧（Frame）传输数据。
  - **服务端主动推送**：无需客户端轮询，可直接发送消息。



##### **典型应用场景**

**1. WebSocket 适用场景**

- **实时 Web 应用**：在线聊天、协同编辑、股票行情推送。
- **网页游戏**：玩家动作同步、怪物行为推送。
- **IoT 控制台**：设备状态实时监控（需结合 Web 前端）。

**2. 传统 Socket 适用场景**

- **自定义协议**：开发专有通信协议（如游戏服务器、金融交易系统）。
- **高性能服务**：需要极致优化的场景（如高频交易、音视频流传输）。
- **嵌入式设备**：资源受限环境下的轻量级通信（如传感器网络）。

