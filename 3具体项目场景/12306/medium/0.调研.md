



12306 网站在 2015 年春运高峰日处理了超过 180 亿次车票查询服务，平均 TPS 超过 **30 万次 /s**



内存计算 NoSQL 数据库集中存 储订单 / 电子客票，提供以 Key-Value 为主的查询服务，订单查询的 TPS 由 200 次 /s 左右提升至 5 000 次 /s 以上





(1)内存计算 NoSQL 数据库取代传统数据库，大幅提升车票并发查询能力，车票查询的 TPS/

QPS（Transaction/Query per Second）由不足1 000 次 /s 提升至超过 20 000 次 /s，RT（Response Time）由原来的 1 s 缩减至 10 ms，使用户可以快速获取到车次及余票情况。

(2)构建交易处理排队系统,排队系统中也采用内存计算 NoSQL 数据库

(3)对订单 / 电子客票进行分节点分库分表改造

(4)对订单 / 电子客票生成和查询进行了读写分离，使用内存计算 NoSQL 数据库集中存储订单 / 电子客票，提供以 Key-Value 为主的查询服务，订单查询的 TPS 由 200 次 /s 左右提升至 5 000 次 /s

以上，大幅提升了订单 / 电子客票的查询效率。







 **2013 年底**起启动了12306 网站的第 2 轮架构优化

(1)将**用户登录及常用联系人查询**等业务迁移至内存数据库中，提高了相关业务的处理性能和可

靠性

(2)生产中心间实现双活，提升网站的安全性和可靠性，并将订单 / 电子客票集群的处理能力提高 1 倍

(3)在**公有云上**部署车票查询服务，通过策略配置可随时将**车票查询流量分流至公用云**，以缓解

在售票高峰期网站的处理资源和带宽压力

- 在互联网公用云上部署了车票查询集群及查询服务，由 CDN 完成车票查询流量在第 1 生产中

心、第 2 生产中心以及公有云间的流量分配，流量分配可通过动态调整策略在线完成





消息队列本质:

流量进行削峰，最容易想到的解决方案就是用消息队列来缓冲瞬时流量，把**同步的直接调用转换成异步的间接推送**，中间通过一个队列在一端承接瞬时的流量洪峰，在另一端平滑地将消息推送出去。在这里，消息队列就像“水库”一样，拦蓄上游的洪水，削减进入下游河道的洪峰流量，从而达到减免洪水灾害的目的。